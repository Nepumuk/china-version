<!doctype html>
<html>

    <head>
        <title>SVO</title>
        <!-- Load jQuery -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <!-- Load the jspsych library and plugins -->
        <script src="scripts/jspsych.js"></script>
        <script src="scripts/plugins/jspsych-text.js"></script>
        <script src="scripts/plugins/jspsych-single-stim.js"></script>
        <script src="scripts/plugins/jspsych-survey-text.js"></script>
        <!-- Load the stylesheet -->
        <link href="css/jspsych.css" type="text/css" rel="stylesheet"></link>
    </head>

    <body>
        <div id="jspsych_target"></div>
    </body>

    <script>
	// Experiment parameters
        var n_trials = 30;
        var stimuli = ["img/Probe Stimuli 1.gif", "img/Probe Stimuli 2.gif"];
        var stimuli_types = ["Probe"];
        var sprache = ["audio/summer.mp3"];

        // Experiment Instructions
        var welcome_message = "<div id='instructions'><p>Welcome to the " +
            "experiment. To verify your nationality, please type the word you hear. " + 
            "Press enter to begin.</p></div>";

        var instructions = "<div id='instructions'><p>blablabla " +
            "lalalalalalallalalalalalalalallallalalalallaalalal:</p><p>" +
            "<img src='img/Probe Stimuli 1.gif'></p><p>Press the arrow " +
            "key that corresponds to the direction that the middle arrow " +
            "is pointing. For example, in this case you would press the " +
            "right arrow key.</p><p>Press enter to start.</p>";

        var debrief = "<div id='instructions'><p> Vielen Danke " +
            "participating!  Press enter to see the data.</p></div>";
            
        //defining questions that go together
       	var page_1_questions = ["Please type the word you have heard"];
        var page_2_questions = ["Did you feel stressed during the experiment?"];
	var page_3_questions = ["Age", "Gender", "Nationality", "In which country did you live most of your life?"];
	var page_4_questions = ["What do you think was tested in this experimemt?"];
	
        // Generating Random Order for Stimuli
        var stimuli_random_order = [];
        var opt_data = [];

        for (var i = 0; i < n_trials; i++) {
            var random_choice = Math.floor(Math.random() * stimuli.length);

            stimuli_random_order.push(stimuli[random_choice]);
            opt_data.push({
                "stimulus_type": stimuli_types[random_choice]
            });
        }
        
        //define blocks
	//if-then clause
    	var wuerfeln = Math.ceil(Math.random() * 6);
    	if (wuerfeln > 50)
    	{
    		var instruction_block = {
                type: "text",
                text: [welcome_message],
                timing_post_trial: 2500,
        	};
        	
        	var survey_block = {
        	type: 'survey-text',
            	questions: [page_1_questions],
        	};
        	
        	var test1_block = {
                type: "single-stim",
                stimuli: Probe Stimuli 1.gif,
                choices: [37, 39],
		timing_stim: 3000,
		timing_response: 3000,
		continue_after_response: true,
		timing_post_trial: 2500,
                data: opt_data,
        	};
        
        	var instruction2_block = {
                type: "text",
                text: [instructions],
                timing_post_trial: 2500,
		};    

        	var test_block = {
                type: "single-stim",
                stimuli: stimuli_random_order,
                choices: [37, 39],
		timing_stim: 4000,
		timing_response: 4500,
		continue_after_response: true,
		timing_post_trial: 2500,
                data: opt_data,
        	};
            
		var survey2_block = {
        	type: 'survey-text',
            	questions: [page_2_questions, page_3_questions, page_4_questions],
		};
        
        	var debrief_block = {
                type: "text",
                text: [debrief],
        	};
        	
    	} else {
    	  	var instruction_block = {
                type: "text",
                text: [welcome_message],
                timing_post_trial: 2500,
            	};
        
        	var survey_block = {
            	type: 'survey-text',
            	questions: [page_1_questions],
        	};
        
        	var test1_block = {
                type: "single-stim",
                stimuli: Probe Stimuli 1.gif,
                choices: [37, 39],
		timing_stim: 3000,
		timing_response: 3000,
		continue_after_response: true,
		timing_post_trial: 2500,
                data: opt_data,
        	};
        	
        	var instruction2_block = {
                type: "text",
                text: [instructions],
                timing_post_trial: 2500,
        	};    

        	var test_block = {
                type: "single-stim",
                stimuli: stimuli_random_order,
                choices: [37, 39],
		timing_post_trial: 2500,
                data: opt_data,
        	};
            
		var survey2_block = {
            	type: 'survey-text',
            	questions: [page_2_questions, page_3_questions, page_4_questions],
		};
        
        	var debrief_block = {
                type: "text",
                text: [debrief],
        	};	
    	}
    	// Ende If
      
        jsPsych.init({
            display_element: $('#jspsych_target'),
            experiment_structure: [instruction_block, survey_block + test1_block, instruction2_block, test_block, survey2_block, debrief_block],
            on_finish: function(data) {
                $("#jspsych_target").append($('<pre>', {
                    html: jsPsych.dataAsCSV()
                }));

                jsPsych.saveCSVdata("data.csv");
            }
        });
    </script>
</html>
